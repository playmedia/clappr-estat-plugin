!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("clappr")):"function"==typeof define&&define.amd?define(["clappr"],t):"object"==typeof exports?exports.ClapprEstatPlugin=t(require("clappr")):e.ClapprEstatPlugin=t(e.Clappr)}(this,function(e){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=i(2),f=i(1),l=n(f),g=function(e){function t(e){s(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!i.options.estatPlugin)throw new Error(i.name+" plugin configuration is missing");if(i._esTagCfg=i.options.estatPlugin.eStatTagCfg,!i._esTagCfg)throw new Error(i.name+' plugin : "eStatTagCfg" configuration property is missing');if(!i._esTagCfg.serial)throw new Error(i.name+" plugin : eStat serial is missing in configuration");if(!i._esTagCfg.streaming||!i._esTagCfg.streaming.streamName)throw new Error(i.name+" plugin : eStat stream name is missing in configuration");return i._esEvents={},i._esDebug=i.options.estatPlugin.debug===!0,i._esSecure=i.options.estatPlugin.secure===!0,i._esLoaded=!1,(0,l["default"])(function(){i._esLoaded=!0,i.eStatCreateTag()},"5.2",i._esDebug,i._esSecure),i}return o(t,e),r(t,[{key:"name",get:function(){return"estat_streaming_mu"}}]),r(t,[{key:"bindEvents",value:function(){this.listenTo(this.core.mediaControl,u.Events.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this._container=this.core.getCurrentContainer(),this._container&&(this.listenTo(this._container,u.Events.CONTAINER_TIMEUPDATE,this.onTimeUpdate),this.listenTo(this._container,u.Events.CONTAINER_PLAY,this.onPlay),this.listenTo(this._container,u.Events.CONTAINER_STOP,this.onStop),this.listenTo(this._container,u.Events.CONTAINER_PAUSE,this.onPause),this.listenTo(this._container,u.Events.CONTAINER_SEEK,this.onSeek),this.listenTo(this._container,u.Events.CONTAINER_STATE_BUFFERING,this.onBuffering),this.listenTo(this._container,u.Events.CONTAINER_STATE_BUFFERFULL,this.onBufferfull),this.listenTo(this._container,u.Events.CONTAINER_ENDED,this.onEnded),this.eStatCreateTag())}},{key:"getExternalInterface",value:function(){return{eStatStreamTag:this.eStatTag}}},{key:"containerChanged",value:function(){this.stopListening(),this.bindEvents()}},{key:"eStatTagDefaultConfig",value:function(){var e=this;return this._container?{measure:"streaming",streaming:{diffusion:"replay",callbackPosition:function(){return e.trunc(e.playerPosition)},playerName:"Clappr",playerVersion:u.version,playerObj:this.playerElement}}:{}}},{key:"eStatCreateTag",value:function(e){if(this._esLoaded&&this._container&&(!this._esTag||e)){this._esTagCfgHasDuration=!!this._esTagCfg.streaming.streamDuration,this._esTagCfgHasDiffusion=!!this._esTagCfg.streaming.diffusion,this._esTagCfgSatisfied=this._esTagCfgHasDuration&&this._esTagCfgHasDiffusion,this._esTagCfgHasDiffusion&&(this._esDiffusion=this._esTagCfg.streaming.diffusion);var t={};u.$.extend(!0,t,this.eStatTagDefaultConfig(),this._esTagCfg),this._esTag=new window.eStatTag(t)}}},{key:"eStatSatisfyTagCfg",value:function(){var e={streaming:{}};this._esTagCfgHasDiffusion||(this.isLive?e.streaming.diffusion=this._container.isDvrEnabled()?"timeshifting":"live":e.streaming.diffusion="replay",this._esDiffusion=e.streaming.diffusion),this._esTagCfgHasDuration||this.isLive||(e.streaming.streamDuration=this.trunc(this.playerDuration)),this._esTag&&this._esTag.set(e),this._esTagCfgSatisfied=!0}},{key:"esTagNotify",value:function(e,t){this._esTag&&this._esTag.notifyPlayer(e,t)}},{key:"eStatTag",value:function(){return this._esTag}},{key:"trunc",value:function(e){return parseInt(e,10)}},{key:"recallEvent",value:function(e,t){this._esEvents[e]=t}},{key:"forgetEvent",value:function(e){delete this._esEvents[e]}},{key:"posEvent",value:function(e){return this._esEvents.hasOwnProperty(e)?this._esEvents[e]:-1}},{key:"onTimeUpdate",value:function(e){this._position=e.current||0}},{key:"onPlay",value:function(){this.recallEvent("play",this.trunc(this.playerPosition)),this._esTagCfgSatisfied||this.eStatSatisfyTagCfg();var e=this.posEvent("seek");e>-1&&("timeshifting"!==this._esDiffusion||this.isTimeshift?this.esTagNotify("pause",e):this.esTagNotify("stop",e),this.forgetEvent("seek")),this.esTagNotify("play")}},{key:"onStop",value:function(){this.esTagNotify("stop")}},{key:"onPause",value:function(){this.esTagNotify("pause")}},{key:"onSeek",value:function(e){this.recallEvent("seek",this.trunc(this.playerPosition))}},{key:"onBuffering",value:function(){var e=this.posEvent("play");e>-1&&(this.forgetEvent("play"),this.recallEvent("buffering",this.trunc(this.playerPosition)))}},{key:"onBufferfull",value:function(){var e=this.posEvent("buffering");e>-1&&(this.forgetEvent("buffering"),this.recallEvent("bufferfull",e))}},{key:"onEnded",value:function(){this.esTagNotify("stop")}},{key:"playerElement",get:function(){return this._container&&this._container.el}},{key:"playerPosition",get:function(){return this.isLive?0:this._position}},{key:"playerDuration",get:function(){return this.isLive?0:this._container&&this._container.getDuration()}},{key:"isLive",get:function(){return this._container.getPlaybackType()===u.Playback.LIVE}},{key:"isTimeshift",get:function(){return this._container.isDvrEnabled()&&this._container.isDvrInUse()}}]),t}(u.CorePlugin);t["default"]=g,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=arguments.length<=1||void 0===arguments[1]?"5.2":arguments[1],i=arguments[2],n=arguments[3],s=window,a=document,o="script";if(!s.eStatTag){var r=n===!0?"https:":"",u=i===!0?"integration-":"",f=a.getElementsByTagName(o)[0],l=a.createElement(o);l.src=r+"//prof.estat.com/js/mu-"+u+t+".js",l.async=!0,"function"==typeof e&&(l.onload=e),f.parentNode.insertBefore(l,f)}},e.exports=t["default"]},function(t,i){t.exports=e}])});