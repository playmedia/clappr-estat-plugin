!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("clappr")):"function"==typeof define&&define.amd?define(["clappr"],e):"object"==typeof exports?exports.ClapprEstatPlugin=e(require("clappr")):t.ClapprEstatPlugin=e(t.Clappr)}(window,function(n){return function(n){var i={};function s(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,s),e.l=!0,e.exports}return s.m=n,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,s=n(1),o=(i=n(2))&&i.__esModule?i:{default:i};function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function u(t,e,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(i){var s=Object.getOwnPropertyDescriptor(i,e);return s.get?s.get.call(n):s.value}})(t,e,n||t)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t){function n(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(e=a(this,f(n).call(this,t))).canLoad()?(e._esEvents={},e.configurePlugin(),e._esLoaded=!1,(0,o.default)(function(){e._esLoaded=!0,e.eStatCreateTag()}),e):(console.error&&console.error(e.name+" plugin : Clappr version 0.3.0 or greater not yet supported"),a(e))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(n,s.CorePlugin),c(n,[{key:"name",get:function(){return"estat_streaming_mu"}}]),c(n,[{key:"canLoad",value:function(){var t=s.version.split(".");return 1<t.length&&t[1]<3}},{key:"configurePlugin",value:function(){if(this.options.estatPlugin){if(this._esTagCfg=this.options.estatPlugin.eStatTagCfg,!this._esTagCfg)throw new Error(this.name+' plugin : "eStatTagCfg" configuration property is missing');if(!this._esTagCfg.serial)throw new Error(this.name+" plugin : eStat serial is missing in configuration");if(!this._esTagCfg.streaming||!this._esTagCfg.streaming.streamName)throw new Error(this.name+" plugin : eStat stream name is missing in configuration");this._esDebug=!0===this.options.estatPlugin.debug}}},{key:"destroy",value:function(){this.ensureTagIsStopped(this._esTag),this._esTag=null,u(f(n.prototype),"destroy",this).call(this)}},{key:"ensureTagIsStopped",value:function(t){t&&t.notifyPlayer("stop")}},{key:"bindEvents",value:function(){this.listenTo(this.core.mediaControl,s.Events.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this._container=this.core.getCurrentContainer(),this._container&&(this.listenTo(this._container,s.Events.CONTAINER_TIMEUPDATE,this.onTimeUpdate),this.listenTo(this._container,s.Events.CONTAINER_PLAY,this.onPlay),this.listenTo(this._container,s.Events.CONTAINER_STOP,this.onStop),this.listenTo(this._container,s.Events.CONTAINER_PAUSE,this.onPause),this.listenTo(this._container,s.Events.CONTAINER_SEEK,this.onSeek),this.listenTo(this._container,s.Events.CONTAINER_STATE_BUFFERING,this.onBuffering),this.listenTo(this._container,s.Events.CONTAINER_STATE_BUFFERFULL,this.onBufferfull),this.listenTo(this._container,s.Events.CONTAINER_ENDED,this.onEnded))}},{key:"getExternalInterface",value:function(){return{eStatStreamTag:this.eStatTag}}},{key:"containerChanged",value:function(){this.stopListening(),this.configurePlugin(),this.eStatCreateTag(!0),this.bindEvents()}},{key:"eStatTagDefaultConfig",value:function(){var t=this;return this._container?{measure:"streaming",streaming:{diffusion:"replay",callbackPosition:function(){return t.trunc(t.playerPosition)},playerName:"Clappr",playerVersion:s.version,playerObj:this.playerElement,pluginName:"clappr-estat-plugin",pluginVersion:this.pluginVersion}}:{}}},{key:"eStatCreateTag",value:function(t){if(this._esLoaded&&this._container&&this._esTagCfg&&(!this._esTag||t)){this._esTagCfgHasDuration=!!this._esTagCfg.streaming.streamDuration,this._esTagCfgHasDiffusion=!!this._esTagCfg.streaming.diffusion,this._esTagCfgSatisfied=this._esTagCfgHasDuration&&this._esTagCfgHasDiffusion,this._esTagCfgHasDiffusion&&(this._esDiffusion=this._esTagCfg.streaming.diffusion),this._esTag&&this.ensureTagIsStopped(this._esTag),this._esEvents={};var e={};s.$.extend(!0,e,this.eStatTagDefaultConfig(),this._esTagCfg),this._esTag=new window.eStatTag(e)}}},{key:"eStatSatisfyTagCfg",value:function(){var t={streaming:{}};this._esTagCfgHasDiffusion||(this.isLive?t.streaming.diffusion=this._container.isDvrEnabled()?"timeshifting":"live":t.streaming.diffusion="replay",this._esDiffusion=t.streaming.diffusion),this._esTagCfgHasDuration||this.isLive||(t.streaming.streamDuration=this.trunc(this.playerDuration)),this._esTag&&this._esTag.set(t),this._esTagCfgSatisfied=!0}},{key:"esTagNotify",value:function(t,e){!0===this._esDebug&&console.log(this.name+" plugin : notify "+t+" event"),this._esTag&&this._esTag.notifyPlayer(t,e)}},{key:"eStatTag",value:function(){return this._esTag}},{key:"trunc",value:function(t){return parseInt(t,10)}},{key:"recallEvent",value:function(t,e){this._esEvents[t]=e}},{key:"forgetEvent",value:function(t){delete this._esEvents[t]}},{key:"posEvent",value:function(t){return this._esEvents.hasOwnProperty(t)?this._esEvents[t]:-1}},{key:"onTimeUpdate",value:function(t){this._position=t.current||0}},{key:"onPlay",value:function(){this.recallEvent("play",this.trunc(this.playerPosition)),this.forgetEvent("pause"),this.forgetEvent("stop"),this._esTagCfgSatisfied||this.eStatSatisfyTagCfg();var t=this.posEvent("seek");-1<t&&("timeshifting"!==this._esDiffusion||this.isTimeshift?this.esTagNotify("pause",t):this.esTagNotify("stop",t),this.forgetEvent("seek")),this.esTagNotify("play")}},{key:"onStop",value:function(){this.recallEvent("stop",this.trunc(this.playerPosition)),this.forgetEvent("play"),this.esTagNotify("stop")}},{key:"onPause",value:function(){this.recallEvent("pause",this.trunc(this.playerPosition)),this.forgetEvent("play"),!this.isLive&&this.isEnd||(-1<this.posEvent("stop")?this.forgetEvent("stop"):this.esTagNotify("pause"))}},{key:"onSeek",value:function(){this.recallEvent("seek",this.trunc(this.playerPosition))}},{key:"onBuffering",value:function(){-1<this.posEvent("play")&&(this.forgetEvent("play"),this.recallEvent("buffering",this.trunc(this.playerPosition)))}},{key:"onBufferfull",value:function(){var t=this.posEvent("buffering");-1<t&&(this.forgetEvent("buffering"),this.recallEvent("bufferfull",t))}},{key:"onEnded",value:function(){this.esTagNotify("stop")}},{key:"playerElement",get:function(){return this._container&&this._container.el}},{key:"pluginVersion",get:function(){return"0.4.1"}},{key:"playerPosition",get:function(){return this.isLive?0:this._position}},{key:"playerDuration",get:function(){return this.isLive?0:this._container&&this._container.getDuration()}},{key:"isLive",get:function(){return this._container.getPlaybackType()===s.Playback.LIVE}},{key:"isTimeshift",get:function(){return this._container.isDvrEnabled()&&this._container.isDvrInUse()}},{key:"isEnd",get:function(){return this.trunc(this.playerDuration)===this.trunc(this.playerPosition)}}]),n}();e.default=h,t.exports=e.default},function(t,e){t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"5.4",n=window,i=document;if(n.eStatTag)return void("function"==typeof t&&t());var s=i.getElementsByTagName("script")[0],o=i.createElement("script");o.src="https://prof.estat.com/js/mu-"+e+".js",o.async=!0,"function"==typeof t&&(o.onload=t);s.parentNode.insertBefore(o,s)},t.exports=e.default}])});