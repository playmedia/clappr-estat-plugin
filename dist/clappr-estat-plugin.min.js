!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("clappr")):"function"==typeof define&&define.amd?define(["clappr"],e):"object"==typeof exports?exports.ClapprEstatPlugin=e(require("clappr")):t.ClapprEstatPlugin=e(t.Clappr)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in s)return s.value;var r=s.get;if(void 0!==r)return r.call(n)},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=i(1),f=i(2),l=function(t){return t&&t.__esModule?t:{default:t}}(f),h=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._esEvents={},i.configurePlugin(),i._esLoaded=!1,(0,l.default)(function(){i._esLoaded=!0,i.eStatCreateTag()},"5.2",i._esDebug,i._esSecure),i}return o(e,t),a(e,[{key:"name",get:function(){return"estat_streaming_mu"}}]),a(e,[{key:"configurePlugin",value:function(){if(this.options.estatPlugin){if(this._esTagCfg=this.options.estatPlugin.eStatTagCfg,!this._esTagCfg)throw new Error(this.name+' plugin : "eStatTagCfg" configuration property is missing');if(!this._esTagCfg.serial)throw new Error(this.name+" plugin : eStat serial is missing in configuration");if(!this._esTagCfg.streaming||!this._esTagCfg.streaming.streamName)throw new Error(this.name+" plugin : eStat stream name is missing in configuration");this._esDebug=!0===this.options.estatPlugin.debug,this._esSecure=!0===this.options.estatPlugin.secure}}},{key:"destroy",value:function(){this.ensureTagIsStopped(this._esTag),this._esTag=null,r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}},{key:"ensureTagIsStopped",value:function(t){t&&t.notifyPlayer("stop")}},{key:"bindEvents",value:function(){this.listenTo(this.core.mediaControl,u.Events.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this._container=this.core.getCurrentContainer(),this._container&&(this.listenTo(this._container,u.Events.CONTAINER_TIMEUPDATE,this.onTimeUpdate),this.listenTo(this._container,u.Events.CONTAINER_PLAY,this.onPlay),this.listenTo(this._container,u.Events.CONTAINER_STOP,this.onStop),this.listenTo(this._container,u.Events.CONTAINER_PAUSE,this.onPause),this.listenTo(this._container,u.Events.CONTAINER_SEEK,this.onSeek),this.listenTo(this._container,u.Events.CONTAINER_STATE_BUFFERING,this.onBuffering),this.listenTo(this._container,u.Events.CONTAINER_STATE_BUFFERFULL,this.onBufferfull),this.listenTo(this._container,u.Events.CONTAINER_ENDED,this.onEnded))}},{key:"getExternalInterface",value:function(){return{eStatStreamTag:this.eStatTag}}},{key:"containerChanged",value:function(){this.stopListening(),this.configurePlugin(),this.eStatCreateTag(!0),this.bindEvents()}},{key:"eStatTagDefaultConfig",value:function(){var t=this;return this._container?{measure:"streaming",streaming:{diffusion:"replay",callbackPosition:function(){return t.trunc(t.playerPosition)},playerName:"Clappr",playerVersion:u.version,playerObj:this.playerElement}}:{}}},{key:"eStatCreateTag",value:function(t){if(this._esLoaded&&this._container&&this._esTagCfg&&(!this._esTag||t)){this._esTagCfgHasDuration=!!this._esTagCfg.streaming.streamDuration,this._esTagCfgHasDiffusion=!!this._esTagCfg.streaming.diffusion,this._esTagCfgSatisfied=this._esTagCfgHasDuration&&this._esTagCfgHasDiffusion,this._esTagCfgHasDiffusion&&(this._esDiffusion=this._esTagCfg.streaming.diffusion),this._esTag&&this.ensureTagIsStopped(this._esTag),this._esEvents={};var e={};u.$.extend(!0,e,this.eStatTagDefaultConfig(),this._esTagCfg),this._esTag=new window.eStatTag(e)}}},{key:"eStatSatisfyTagCfg",value:function(){var t={streaming:{}};this._esTagCfgHasDiffusion||(this.isLive?t.streaming.diffusion=this._container.isDvrEnabled()?"timeshifting":"live":t.streaming.diffusion="replay",this._esDiffusion=t.streaming.diffusion),this._esTagCfgHasDuration||this.isLive||(t.streaming.streamDuration=this.trunc(this.playerDuration)),this._esTag&&this._esTag.set(t),this._esTagCfgSatisfied=!0}},{key:"esTagNotify",value:function(t,e){!0===this._esDebug&&console.log(this.name+" plugin : notify "+t+" event"),this._esTag&&this._esTag.notifyPlayer(t,e)}},{key:"eStatTag",value:function(){return this._esTag}},{key:"trunc",value:function(t){return parseInt(t,10)}},{key:"recallEvent",value:function(t,e){this._esEvents[t]=e}},{key:"forgetEvent",value:function(t){delete this._esEvents[t]}},{key:"posEvent",value:function(t){return this._esEvents.hasOwnProperty(t)?this._esEvents[t]:-1}},{key:"onTimeUpdate",value:function(t){this._position=t.current||0}},{key:"onPlay",value:function(){this.recallEvent("play",this.trunc(this.playerPosition)),this.forgetEvent("pause"),this.forgetEvent("stop"),this._esTagCfgSatisfied||this.eStatSatisfyTagCfg();var t=this.posEvent("seek");t>-1&&("timeshifting"!==this._esDiffusion||this.isTimeshift?this.esTagNotify("pause",t):this.esTagNotify("stop",t),this.forgetEvent("seek")),this.esTagNotify("play")}},{key:"onStop",value:function(){this.recallEvent("stop",this.trunc(this.playerPosition)),this.forgetEvent("play"),this.esTagNotify("stop")}},{key:"onPause",value:function(){if(this.recallEvent("pause",this.trunc(this.playerPosition)),this.forgetEvent("play"),this.isLive||!this.isEnd)return this.posEvent("stop")>-1&&this.isLiveHtml5?void this.forgetEvent("stop"):void this.esTagNotify("pause")}},{key:"onSeek",value:function(t){this.recallEvent("seek",this.trunc(this.playerPosition))}},{key:"onBuffering",value:function(){this.posEvent("play")>-1&&(this.forgetEvent("play"),this.recallEvent("buffering",this.trunc(this.playerPosition)))}},{key:"onBufferfull",value:function(){var t=this.posEvent("buffering");t>-1&&(this.forgetEvent("buffering"),this.recallEvent("bufferfull",t))}},{key:"onEnded",value:function(){this.esTagNotify("stop")}},{key:"playerElement",get:function(){return this._container&&this._container.el}},{key:"playerPosition",get:function(){return this.isLive?0:this._position}},{key:"playerDuration",get:function(){return this.isLive?0:this._container&&this._container.getDuration()}},{key:"isLive",get:function(){return this._container.getPlaybackType()===u.Playback.LIVE}},{key:"isLiveHtml5",get:function(){return this.isLive&&"html5_video"===this._container.playback.name}},{key:"isTimeshift",get:function(){return this._container.isDvrEnabled()&&this._container.isDvrInUse()}},{key:"isEnd",get:function(){return this.trunc(this.playerDuration)===this.trunc(this.playerPosition)}}]),e}(u.CorePlugin);e.default=h,t.exports=e.default},function(e,i){e.exports=t},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"5.2",i=arguments[2],n=arguments[3],s=window,o=document;if(s.eStatTag)return void("function"==typeof t&&t());var r=!0===n?"https:":"",a=!0===i?"integration-":"",u=o.getElementsByTagName("script")[0],f=o.createElement("script");f.src=r+"//prof.estat.com/js/mu-"+a+e+".js",f.async=!0,"function"==typeof t&&(f.onload=t),u.parentNode.insertBefore(f,u)},t.exports=e.default}])});