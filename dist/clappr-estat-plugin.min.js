!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("clappr")):"function"==typeof define&&define.amd?define(["clappr"],e):"object"==typeof exports?exports.ClapprEstatPlugin=e(require("clappr")):t.ClapprEstatPlugin=e(t.Clappr)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:g(s,e,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),f=i(2),l=i(1),h=n(l),c=function(t){function e(t){s(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(!i.options.estatPlugin)throw new Error(i.name+" plugin configuration is missing");if(i._esTagCfg=i.options.estatPlugin.eStatTagCfg,!i._esTagCfg)throw new Error(i.name+' plugin : "eStatTagCfg" configuration property is missing');if(!i._esTagCfg.serial)throw new Error(i.name+" plugin : eStat serial is missing in configuration");if(!i._esTagCfg.streaming||!i._esTagCfg.streaming.streamName)throw new Error(i.name+" plugin : eStat stream name is missing in configuration");return i._esEvents={},i._esDebug=i.options.estatPlugin.debug===!0,i._esSecure=i.options.estatPlugin.secure===!0,i._esLoaded=!1,(0,h["default"])(function(){i._esLoaded=!0,i.eStatCreateTag()},"5.2",i._esDebug,i._esSecure),i}return r(e,t),u(e,[{key:"name",get:function(){return"estat_streaming_mu"}}]),u(e,[{key:"destroy",value:function(){this.posEvent("stop")===-1&&this.esTagNotify("stop"),this._esTag=null,a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}},{key:"bindEvents",value:function(){this.listenTo(this.core.mediaControl,f.Events.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this._container=this.core.getCurrentContainer(),this._container&&(this.listenTo(this._container,f.Events.CONTAINER_TIMEUPDATE,this.onTimeUpdate),this.listenTo(this._container,f.Events.CONTAINER_PLAY,this.onPlay),this.listenTo(this._container,f.Events.CONTAINER_STOP,this.onStop),this.listenTo(this._container,f.Events.CONTAINER_PAUSE,this.onPause),this.listenTo(this._container,f.Events.CONTAINER_SEEK,this.onSeek),this.listenTo(this._container,f.Events.CONTAINER_STATE_BUFFERING,this.onBuffering),this.listenTo(this._container,f.Events.CONTAINER_STATE_BUFFERFULL,this.onBufferfull),this.listenTo(this._container,f.Events.CONTAINER_ENDED,this.onEnded),this.eStatCreateTag())}},{key:"getExternalInterface",value:function(){return{eStatStreamTag:this.eStatTag}}},{key:"containerChanged",value:function(){this.stopListening(),this.bindEvents()}},{key:"eStatTagDefaultConfig",value:function(){var t=this;return this._container?{measure:"streaming",streaming:{diffusion:"replay",callbackPosition:function(){return t.trunc(t.playerPosition)},playerName:"Clappr",playerVersion:f.version,playerObj:this.playerElement}}:{}}},{key:"eStatCreateTag",value:function(t){if(this._esLoaded&&this._container&&(!this._esTag||t)){this._esTagCfgHasDuration=!!this._esTagCfg.streaming.streamDuration,this._esTagCfgHasDiffusion=!!this._esTagCfg.streaming.diffusion,this._esTagCfgSatisfied=this._esTagCfgHasDuration&&this._esTagCfgHasDiffusion,this._esTagCfgHasDiffusion&&(this._esDiffusion=this._esTagCfg.streaming.diffusion);var e={};f.$.extend(!0,e,this.eStatTagDefaultConfig(),this._esTagCfg),this._esTag=new window.eStatTag(e)}}},{key:"eStatSatisfyTagCfg",value:function(){var t={streaming:{}};this._esTagCfgHasDiffusion||(this.isLive?t.streaming.diffusion=this._container.isDvrEnabled()?"timeshifting":"live":t.streaming.diffusion="replay",this._esDiffusion=t.streaming.diffusion),this._esTagCfgHasDuration||this.isLive||(t.streaming.streamDuration=this.trunc(this.playerDuration)),this._esTag&&this._esTag.set(t),this._esTagCfgSatisfied=!0}},{key:"esTagNotify",value:function(t,e){this._esDebug===!0&&console.log(this.name+" plugin : notify "+t+" event"),this._esTag&&this._esTag.notifyPlayer(t,e)}},{key:"eStatTag",value:function(){return this._esTag}},{key:"trunc",value:function(t){return parseInt(t,10)}},{key:"recallEvent",value:function(t,e){this._esEvents[t]=e}},{key:"forgetEvent",value:function(t){delete this._esEvents[t]}},{key:"posEvent",value:function(t){return this._esEvents.hasOwnProperty(t)?this._esEvents[t]:-1}},{key:"onTimeUpdate",value:function(t){this._position=t.current||0}},{key:"onPlay",value:function(){this.recallEvent("play",this.trunc(this.playerPosition)),this.forgetEvent("pause"),this.forgetEvent("stop"),this._esTagCfgSatisfied||this.eStatSatisfyTagCfg();var t=this.posEvent("seek");t>-1&&("timeshifting"!==this._esDiffusion||this.isTimeshift?this.esTagNotify("pause",t):this.esTagNotify("stop",t),this.forgetEvent("seek")),this.esTagNotify("play")}},{key:"onStop",value:function(){this.recallEvent("stop",this.trunc(this.playerPosition)),this.forgetEvent("play"),this.esTagNotify("stop")}},{key:"onPause",value:function(){if(this.recallEvent("pause",this.trunc(this.playerPosition)),this.forgetEvent("play"),this.isLive||!this.isEnd)return this.posEvent("stop")>-1&&this.isLiveHtml5?void this.forgetEvent("stop"):void this.esTagNotify("pause")}},{key:"onSeek",value:function(t){this.recallEvent("seek",this.trunc(this.playerPosition))}},{key:"onBuffering",value:function(){this.posEvent("play")>-1&&(this.forgetEvent("play"),this.recallEvent("buffering",this.trunc(this.playerPosition)))}},{key:"onBufferfull",value:function(){var t=this.posEvent("buffering");t>-1&&(this.forgetEvent("buffering"),this.recallEvent("bufferfull",t))}},{key:"onEnded",value:function(){this.esTagNotify("stop")}},{key:"playerElement",get:function(){return this._container&&this._container.el}},{key:"playerPosition",get:function(){return this.isLive?0:this._position}},{key:"playerDuration",get:function(){return this.isLive?0:this._container&&this._container.getDuration()}},{key:"isLive",get:function(){return this._container.getPlaybackType()===f.Playback.LIVE}},{key:"isLiveHtml5",get:function(){return this.isLive&&"html5_video"===this._container.playback.name}},{key:"isTimeshift",get:function(){return this._container.isDvrEnabled()&&this._container.isDvrInUse()}},{key:"isEnd",get:function(){return this.trunc(this.playerDuration)===this.trunc(this.playerPosition)}}]),e}(f.CorePlugin);e["default"]=c,t.exports=e["default"]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"5.2",i=arguments[2],n=arguments[3],s=window,o=document,r="script";if(s.eStatTag)return void("function"==typeof t&&t());var a=n===!0?"https:":"",u=i===!0?"integration-":"",f=o.getElementsByTagName(r)[0],l=o.createElement(r);l.src=a+"//prof.estat.com/js/mu-"+u+e+".js",l.async=!0,"function"==typeof t&&(l.onload=t),f.parentNode.insertBefore(l,f)},t.exports=e["default"]},function(e,i){e.exports=t}])});